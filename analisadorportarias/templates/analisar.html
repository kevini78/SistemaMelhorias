<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Analisar Portaria - Analisador de Portarias</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://fonts.googleapis.com/css2?family=Rawline:wght@300;400;500;600;700&family=Raleway:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --color-primary-default: #1351b4;
            --color-primary-pastel-02: #dbe8fb;
            --color-secondary-01: #fff;
            --color-secondary-02: #f8f8f8;
            --color-secondary-03: #ededed;
            --color-secondary-04: #ccc;
            --color-secondary-07: #555;
            --color-secondary-08: #333;
            --color-success: #168821;
            --color-danger: #e60000;
            --font-family-base: Rawline, Raleway, sans-serif;
        }

        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }

        html {
            font-size: 62.5%;
        }

        body { 
            font-family: var(--font-family-base);
            background: var(--color-secondary-01);
            color: var(--color-secondary-08);
            font-size: 1.6rem;
            line-height: 1.75;
        }
        
        .header {
            background: var(--color-secondary-01);
            color: var(--color-secondary-08);
            padding: 1.5rem 0;
            border-bottom: 1px solid var(--color-secondary-03);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .logo img {
            height: 40px;
        }

        .header-divider {
            height: 32px;
            border-left: 1px solid var(--color-secondary-04);
        }
        
        .site-name {
            font-size: 2rem;
            font-weight: 600;
        }
        
        .nav a {
            color: var(--color-secondary-07);
            text-decoration: none;
            font-weight: 500;
            margin-left: 2rem;
            font-size: 1.6rem;
            transition: color 0.2s;
        }
        
        .nav a:hover {
            color: var(--color-primary-default);
        }
        
        .main {
            max-width: 960px;
            margin: 4rem auto;
            padding: 0 2rem;
        }
        
        .card {
            background: var(--color-secondary-01);
            border-radius: 8px;
            padding: 3rem;
            border: 1px solid var(--color-secondary-03);
            margin-bottom: 3rem;
        }
        
        .card h2 {
            font-size: 2.8rem;
            font-weight: 600;
            margin-bottom: 2rem;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 2rem;
        }
        
        .form-group label {
            display: block;
            font-weight: 500;
            margin-bottom: 1rem;
        }
        
        .form-group input[type="text"], .form-group textarea {
            width: 100%;
            padding: 1.2rem;
            border: 1px solid var(--color-secondary-04);
            border-radius: 6px;
            font-size: 1.6rem;
            transition: border-color 0.2s;
            font-family: var(--font-family-base);
        }
        
        .form-group input[type="text"]:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--color-primary-default);
        }
        
        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .radio-group {
            display: flex;
            gap: 2.5rem;
            margin-bottom: 2rem;
            justify-content: center;
        }
        
        .radio-item {
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        
        .radio-item input[type="radio"] {
            width: 18px;
            height: 18px;
        }
        
        .buttons {
            display: flex;
            justify-content: center;
            gap: 1.5rem;
            margin-top: 1rem;
        }

        .btn {
            padding: 1.2rem 2.5rem;
            border: 1px solid var(--color-primary-default);
            border-radius: 6px;
            font-size: 1.6rem;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-block;
            font-family: var(--font-family-base);
            min-width: 200px;
            text-align: center;
        }
        
        .btn-primary {
            background: var(--color-primary-default);
            color: var(--color-secondary-01);
        }
        
        .btn-primary:hover {
            background: #0c326f;
            border-color: #0c326f;
        }
        
        .btn-secondary {
            background: var(--color-secondary-01);
            color: var(--color-primary-default);
        }
        
        .btn-secondary:hover {
            background: var(--color-secondary-02);
        }

        .resultado-card {
            background: var(--color-secondary-01);
            border-radius: 8px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid var(--color-secondary-03);
        }
        
        .resultado-card h3 {
            font-size: 2rem;
            margin-bottom: 1rem;
        }

        .resultado-card.success {
            border-left: 4px solid var(--color-success);
        }
        
        .resultado-card.error {
            border-left: 4px solid var(--color-danger);
        }
        
        .portaria-item {
            background: var(--color-secondary-01);
            border-radius: 8px;
            padding: 2rem;
            margin-top: 2rem;
            border: 1px solid var(--color-secondary-03);
        }
        
        .portaria-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--color-secondary-03);
        }
        
        .portaria-title {
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        .portaria-meta {
            font-size: 1.4rem;
            color: var(--color-secondary-07);
        }
        
        .erro-list {
            list-style: none;
            padding: 0;
            margin-top: 1rem;
        }
        
        .erro-list li {
            background: #ffebee;
            color: var(--color-danger);
            padding: 1rem;
            margin-bottom: 0.8rem;
            border-radius: 6px;
            border-left: 3px solid var(--color-danger);
            font-size: 1.5rem;
        }
        
        .erro-list li small {
            display: block;
            color: #b71c1c;
            opacity: 0.9;
            font-size: 1.3rem;
            margin-top: 0.5rem;
        }
        
        .section-title {
            font-size: 1.8rem;
            font-weight: 600;
            margin-top: 2rem;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--color-secondary-03);
        }

        .erros-section .section-title {
            color: var(--color-danger);
        }
        
        .pessoas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        
        .pessoa-item {
            background: var(--color-secondary-02);
            border: 1px solid var(--color-secondary-03);
            border-radius: 6px;
            padding: 1.5rem;
        }
        
        .pessoa-item strong {
            font-weight: 600;
            font-size: 1.5rem;
            display: block;
            margin-bottom: 0.5rem;
        }
        
        .pessoa-item small {
            color: var(--color-secondary-07);
            display: block;
            margin-bottom: 0.3rem;
            font-size: 1.3rem;
        }
        
        .sucesso-message {
            background: #e8f5e9;
            color: var(--color-success);
            padding: 1.5rem;
            border-radius: 6px;
            text-align: center;
            font-weight: 500;
            margin-top: 1rem;
            border: 1px solid var(--color-success);
        }
        
        .footer {
            background: var(--color-secondary-01);
            color: var(--color-secondary-07);
            text-align: center;
            padding: 2rem 0;
            margin-top: 6rem;
            border-top: 1px solid var(--color-secondary-03);
        }
        
        .footer p {
            font-size: 1.4rem;
        }
        
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 1.5rem;
            }

            .nav {
                width: 100%;
                display: flex;
                justify-content: center;
                gap: 1rem;
            }
            
            .nav a {
                margin: 0 1rem;
            }
            
            .card {
                padding: 2.5rem 2rem;
            }
            
            .radio-group {
                flex-direction: column;
                align-items: flex-start;
                gap: 1.5rem;
            }
            
            .buttons {
                flex-direction: column;
            }

            .btn {
                width: 100%;
                margin-right: 0;
                margin-bottom: 1rem;
            }
            
            .portaria-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <div class="logo-container">
                <a href="/" class="logo"><img src="/static/images/logo-mj.png" alt="Logo MJ"></a>
                <span class="header-divider"></span>
                <span class="site-name">Analisador de Portarias</span>
            </div>
            <nav class="nav">
                <a href="/">Início</a>
                <a href="/configurar">Configurar</a>
                <a href="/analisar">Analisar</a>
            </nav>
        </div>
    </header>
    
    <main class="main">
        <div class="card">
            <h2>Análise de Portarias</h2>
            <form id="form-analisar" method="post">
                <div class="radio-group">
                    <div class="radio-item">
                        <input type="radio" id="analise_url" name="tipo_analise" value="url" checked>
                        <label for="analise_url">Analisar por URL</label>
                    </div>
                    <div class="radio-item">
                        <input type="radio" id="analise_texto" name="tipo_analise" value="texto">
                        <label for="analise_texto">Analisar por Texto</label>
                    </div>
                </div>
                
                <div id="campo_url" class="form-group">
                    <label for="url_portaria">URL da Portaria:</label>
                    <input type="text" name="url_portaria" id="url_portaria" placeholder="https://www.in.gov.br/...">
                </div>
                
                <div id="campo_texto" class="form-group" style="display:none;">
                    <label for="texto_portaria">Texto da Portaria:</label>
                    <textarea name="texto_portaria" id="texto_portaria" placeholder="Cole aqui o texto completo da portaria..."></textarea>
                </div>
                
                <div class="buttons">
                    <button class="btn btn-primary" type="submit">Analisar</button>
                    <a href="/" class="btn btn-secondary">Voltar</a>
                </div>
            </form>
        </div>
        
        <div class="resultado" id="resultado"></div>
    </main>
    
    <footer class="footer">
        <p>Ministério da Justiça e Segurança Pública</p>
    </footer>
    
    <script>
        // Alternar campos
        document.getElementById('analise_url').onchange = function() {
            document.getElementById('campo_url').style.display = '';
            document.getElementById('campo_texto').style.display = 'none';
        };
        document.getElementById('analise_texto').onchange = function() {
            document.getElementById('campo_url').style.display = 'none';
            document.getElementById('campo_texto').style.display = '';
        };
        
        // Submissão AJAX
        document.getElementById('form-analisar').onsubmit = async function(e) {
            e.preventDefault();
            const formData = new FormData(this);
            const resultadoDiv = document.getElementById('resultado');
            resultadoDiv.innerHTML = '<div class="card"><p>Analisando, por favor aguarde...</p></div>';

            const resp = await fetch('/analisar', { method: 'POST', body: formData });
            const data = await resp.json();
            
            let html = '';
            if(data.success && data.resultado) {
                html += `<div class="resultado-card success">
                    <h3>✅ Análise Concluída</h3>
                    <p><strong>Total de portarias:</strong> ${data.resultado.total_portarias || 0}</p>
                    <p><strong>Total de erros:</strong> ${data.resultado.total_erros || 0}</p>
                </div>`;
                
                if(data.resultado.portarias && data.resultado.portarias.length > 0) {
                    data.resultado.portarias.forEach(function(p, idx) {
                        html += `<div class="portaria-item">
                            <div class="portaria-header">
                                <div class="portaria-title">PORTARIA ${p.numero.toUpperCase()} (${p.tipo.toUpperCase()})</div>
                                <div class="portaria-meta">${p.data} • ${p.total_pessoas} pessoas</div>
                            </div>`;
                        
                        if(p.erros && p.erros.length > 0) {
                            html += `<div class="erros-section">
                                <h4 class="section-title">Erros Encontrados (${p.erros.length})</h4>
                                <ul class="erro-list">`;
                            p.erros.forEach(function(erro) {
                                let erroHtml = `<li><strong>${erro.tipo || 'ERRO'}:</strong> ${erro.descrição}`;
                                if(erro.pessoa) erroHtml += `<small>Pessoa: ${erro.pessoa}</small>`;
                                if(erro.idade) erroHtml += `<small>Idade: ${erro.idade} anos</small>`;
                                if(erro.pais) erroHtml += `<small>País: ${erro.pais}</small>`;
                                erroHtml += `</li>`;
                                html += erroHtml;
                            });
                            html += `</ul></div>`;
                        } else {
                            html += `<div class="sucesso-message">Nenhum erro encontrado nesta portaria.</div>`;
                        }
                        
                        if(p.pessoas && p.pessoas.length > 0) {
                            html += `<div>
                                <h4 class="section-title">Pessoas Processadas (${p.pessoas.length})</h4>
                                <div class="pessoas-grid">`;
                            p.pessoas.forEach(function(pessoa) {
                                html += `<div class="pessoa-item">
                                    <strong>${pessoa.nome}</strong>
                                    <small>Documento: ${pessoa.documento} (${pessoa.tipo_documento})</small>
                                    <small>País: ${pessoa.pais}</small>`;
                                if(pessoa.idade) html += `<small>Idade: ${pessoa.idade} anos</small>`;
                                if(pessoa.data_nascimento) html += `<small>Nascimento: ${pessoa.data_nascimento}</small>`;
                                html += `</div>`;
                            });
                            html += `</div></div>`;
                        }
                        
                        html += `</div>`;
                    });
                }
                
                if(data.resultado.arquivos_excel && data.resultado.arquivos_excel.length > 0) {
                    html += `<div class="resultado-card">
                        <h3>Relatórios Excel Gerados</h3>
                        <ul class="erro-list">`;
                    data.resultado.arquivos_excel.forEach(function(f) {
                        html += `<li><a href="/download/${encodeURIComponent(f)}" style="color: var(--color-primary-default);">${f.split('/').pop()}</a></li>`;
                    });
                    html += `</ul></div>`;
                }
            } else {
                html += `<div class="resultado-card error">
                    <h3>❌ Erro na Análise</h3>
                    <p>${data.message || 'Ocorreu um erro desconhecido.'}</p>
                </div>`;
            }
            
            resultadoDiv.innerHTML = html;
        };
    </script>
</body>
</html> 